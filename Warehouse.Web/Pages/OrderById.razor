@page "/order/{orderId:guid}"
@using Warehouse.Core.Orders.Models
@inject IHttpClientFactory ClientFactory
@inject NavigationManager Navigation

<h3>Order Details</h3>

@if (order == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="mb-3">
        <button class="btn btn-primary" @onclick="GoBack">Go Back</button>
    </div>

    <div class="card mb-3">
        <div class="card-header">
            Customer Information
        </div>
        <div class="card-body">
            <p><strong>Name:</strong> @order.Customer.Name</p>
            <p><strong>Email:</strong> @order.Customer.Email</p>
            <p><strong>Phone:</strong> @order.Customer.PhoneNumber</p>
        </div>
    </div>

    <h4>Products</h4>
    <table class="table table-striped table-hover">
        <thead class="table-dark">
        <tr>
            <th>Product ID</th>
            <th>Manufacturer</th>
            <th>Price</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var product in order.Products)
        {
            <tr>
                <td>@product.Id</td>
                <td>@product.Manufacturer.Name</td>
                <td>@product.Price.ToString("C")</td>
            </tr>
        }
        <tr>
            <td colspan="2"><strong>Total</strong></td>
            <td>@order.Products.Sum(p => p.Price).ToString("C")</td>
        </tr>
        </tbody>
    </table>
}

@code {

    [Parameter]
    public Guid OrderId { get; set; }

    private Order order;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            HttpClient httpClient = ClientFactory.CreateClient();
            httpClient.DefaultRequestHeaders.Add("Accept", "application/json");

            order = await httpClient.GetFromJsonAsync<Order>($"https://localhost:7125/api/order/{OrderId}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching order details: {ex.Message}");
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/orders");
    }
}
